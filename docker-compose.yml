version: '3.8'

services:
  # Your FastAPI Application Service
  app:
    build: .
    image: goodbooksunisoft/goodbooks-chatbot:latest # ðŸš¨ CHANGE THIS!
    container_name: goodbooks_chatbot_app
    ports:
      - "8010:8010"
    volumes:
      # This saves your app's data on the server, so it's not lost on restart
      - ./data:/app/data
      - ./data/conversational_memory_vectorstore:/app/conversational_memory_vectorstore
      - ./data/conversational_memory_metadata.json:/app/conversational_memory_metadata.json
      - ./data/user_sessions.json:/app/user_sessions.json
      - ./data/conversation_threads.json:/app/conversation_threads.json
      - ./data/role_context_mapping.json:/app/role_context_mapping.json
      - ./data/chats.json:/app/chats.json
    depends_on:
      - ollama
    restart: always

  # Ollama Service for the gemma:2b model
  ollama:
    image: ollama/ollama
    container_name: ollama_service
    volumes:
      # This saves the downloaded models on your server
      - ollama_data:/root/.ollama
    restart: always
    ports:
      - "11434:11434"  # Ollama API port
volumes:
  ollama_data: